<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Heatmaps</title>
		<style>
			html, body {
				height: 100%;
				margin: 0;
				padding: 0;
			}
			#map {
				height: 100%;
			}
			#floating-panel {
				position: absolute;
				top: 10px;
				left: 25%;
				z-index: 5;
				background-color: #fff;
				padding: 5px;
				border: 1px solid #999;
				text-align: center;
				font-family: 'Roboto','sans-serif';
				line-height: 30px;
				padding-left: 10px;
			}
		</style>
		<script src="lib/jquery-1.11.3.js"></script>
		<!-- <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAcktFen-Z7CQCe0dxIKmxeRReUzuwBhfUVuhk2aRjVRv1avb-hhQdlkzQnQ1P5PComj1CZx2jeOOyIw" type="text/javascript"></script> -->
	</head>

	<body>
		<!-- <iframe id="dataFile" src="file://./rawlatlongs.html" onload="LoadFile();" style="display: none;"></iframe> -->
		<!-- <iframe id="dataFile" src="rawlatlongs.html" style="display: none;"></iframe> -->
		
		<div id="floating-panel">
			<button onclick="toggleHeatmap()">Toggle Heatmap</button>
			<button onclick="changeGradient()">Change gradient</button>
			<button onclick="changeRadius()">Change radius</button>
			<button onclick="changeOpacity()">Change opacity</button>
		</div>
		
		<div id="map"></div>
		<script>
			var map, heatmap, gradientNumber = 0;
			var myCenterLatLong = new google.maps.LatLng(40.782361, -73.965784);
			
			function createFrame() {
				console.log("Creating iframe");
				$(document.body).append('<IFRAME id="dataFile" style="display: none;">');
				$('iframe#dataFile').attr('src', "rawlatlongs.html");
				$('iframe#dataFile').load(function() {
					console.log("Iframe created");
					initMap();
				});
				/*
				var i = document.createElement("iframe");
				i.id = "dataFile";
				i.src = "rawlatlongs.html";
				i.scrolling = "auto"
				i.style.display = "none";
				document.body.appendChild(i);
				initMap();
				*/
			}
			
			function initMap() {
				console.log("Inside initMap");
				var mapOptions = {
					backgroundColor: '#000000',
					center: myCenterLatLong,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					//mapTypeControlOptions: [google.maps.MapTypeId.ROADMAP, 'M_M&S'],
					//mapTypeControlOptions: [google.maps.MapTypeId.ROADMAP, google.maps.MapTypeId.SATELLITE],
					mapTypeControlOptions: [google.maps.MapTypeId.ROADMAP],
					streetViewControl: false,
					zoom: 13
				};
				map = new google.maps.Map(document.getElementById("map"), mapOptions);
				
				heatmap = new google.maps.visualization.HeatmapLayer({
					data: getPoints(),
					maxIntensity: 10,
					map: map
				});
			}

			function toggleHeatmap() {
				heatmap.setMap(heatmap.getMap() ? null : map);
			}

			function changeGradient() {
				var gradient;
				if (gradientNumber == 3) {
					gradientNumber = 0;
					heatmap.set('gradient', null);
				}
				else if (gradientNumber == 0) {
					gradient = [
						'rgba(0, 255, 255, 0)',
						'rgba(0, 255, 255, 1)',
						'rgba(0, 191, 255, 1)',
						'rgba(0, 127, 255, 1)',
						'rgba(0, 63, 255, 1)',
						'rgba(0, 0, 255, 1)',
						'rgba(0, 0, 223, 1)',
						'rgba(0, 0, 191, 1)',
						'rgba(0, 0, 159, 1)',
						'rgba(0, 0, 127, 1)',
						'rgba(63, 0, 91, 1)',
						'rgba(127, 0, 63, 1)',
						'rgba(191, 0, 31, 1)',
						'rgba(255, 0, 0, 1)'
					];
					gradientNumber++;
				}
				else if (gradientNumber == 1) {
					gradient = [
						'rgba(255, 0, 0, 0)',
						'rgba(255, 255, 0, 0.9)',
						'rgba(0, 255, 0, 0.7)',
						'rgba(173, 255, 47, 0.5)',
						'rgba(152, 251, 152, 0)',
						'rgba(152, 251, 152, 0)',
						'rgba(0, 0, 238, 0.5)',
						'rgba(186, 85, 211, 0.7)',
						'rgba(255, 0, 255, 0.9)',
						'rgba(255, 0, 0, 1)'
					];
					gradientNumber++;
				}
				else if (gradientNumber = 2) {
					gradient = [
						'rgba(255, 0, 0, 0)',
						'rgba(0, 242, 255, 0.9)',
						'rgba(113, 235, 194, 0.9)',
						'rgba(145, 250, 107, 0.9)',
						'rgba(0, 186, 25, 0.9)',
						'rgba(245, 255, 56, 0.9)',
						'rgba(255, 196, 0, 0.9)',
						'rgba(255, 149, 0, 0.9)',
						'rgba(255, 0, 0, 1)'
					];
					gradientNumber++;
				}
				if (gradientNumber > 0) {
					heatmap.set('gradient', gradient);
				}
			}

			function changeRadius() {
				var newRadius = heatmap.get('radius');
				if (newRadius == null)
					newRadius = 0;
				newRadius += 5;
				
				if (newRadius > 15) {
					newRadius = 0;
				}
				heatmap.set('radius', newRadius);
			}

			function changeOpacity() {
				var newOpacity = heatmap.get('opacity');
				if (newOpacity == null)
					newOpacity = 1;
				
				newOpacity -= 0.25;
				
				if (newOpacity < 0.3)
					newOpacity = 1;
					
				heatmap.set('opacity', newOpacity);
			}
			
			function getPoints() {
				console.log("Inside getPoints()");
				var inputLatLongs = [], mapCoordindates = [];
				var iFrame =  document.getElementById('dataFile');
				
				var iFrameBody;
				if ( iFrame.contentDocument ) {
					// FF
					iFrameBody = iFrame.contentDocument.getElementsByTagName('body')[0];
				}
				else if ( iFrame.contentWindow ) {
					// IE
					iFrameBody = iFrame.contentWindow.document.getElementsByTagName('body')[0];
				}
				if (iFrameBody == undefined) {
					console.log("iFrameBody still undefined");
				}
				
				console.log("Done looking for file contents in getPoints()");
				inputLatLongs = iFrameBody.innerHTML.split('\n');
				for (var i = 0; i < inputLatLongs.length; i++) {
					inputLatLongs[i] = inputLatLongs[i].split(",");
					mapCoordindates.push(new google.maps.LatLng(inputLatLongs[i][0], inputLatLongs[i][1]));
				}
			
				return mapCoordindates;
			}
			
		</script>
		<script 
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJX8q3ThLljfIou6UPxhiIDlaSYw6plbs&signed_in=true&libraries=visualization&callback=createFrame">
		</script>
	</body>
</html>